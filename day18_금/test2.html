<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인사 및 휴가 관리 대시보드</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts & Noto Sans KR -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: #f1f5f9;
        }
        /* 파일 입력 커스텀 스타일 */
        .file-input-label {
            display: inline-block;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 500;
            color: #334155;
            background-color: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .file-input-label:hover {
            background-color: #e2e8f0;
        }
        input[type="file"] {
            display: none;
        }
        .file-name-display {
            font-size: 12px;
            color: #64748b;
            margin-left: 8px;
            vertical-align: middle;
        }
        /* 사원 목록 사진 스타일 */
        .emp-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <div id="app-container" class="w-full max-w-screen-2xl mx-auto">
        <!-- 헤더 -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-slate-800">HR & Vacation Dashboard</h1>
            <p class="text-slate-500 mt-1">사원 및 휴가 신청 통합 관리 시스템</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-8 gap-8">

            <!-- ======================================================= -->
            <!-- 왼쪽 컬럼: 부서 관리 -->
            <!-- ======================================================= -->
            <section class="lg:col-span-2 bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-8">
                 <div>
                    <h2 class="text-xl font-semibold text-slate-700 mb-4 border-b pb-3">부서 관리</h2>
                    <form id="department-form" class="space-y-3 mb-4">
                        <div class="flex gap-2">
                           <input type="text" id="dept-name" required placeholder="신규 부서명 입력" class="flex-grow block w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
                           <button type="submit" class="flex-shrink-0 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700">추가</button>
                        </div>
                    </form>
                    <div class="h-[65vh] overflow-y-auto pr-2">
                        <table class="min-w-full">
                           <thead class="bg-slate-100 sticky top-0">
                                <tr>
                                    <th class="text-left py-2 px-3 uppercase font-semibold text-sm text-slate-600">부서명</th>
                                    <th class="text-center py-2 px-3 uppercase font-semibold text-sm text-slate-600 w-16">관리</th>
                                </tr>
                            </thead>
                            <tbody id="department-list">
                                <!-- JS로 부서 목록 동적 생성 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- ======================================================= -->
            <!-- 중간 컬럼: 사원 관리 -->
            <!-- ======================================================= -->
            <section class="lg:col-span-4 bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-8">
                 <!-- 사원 등록 -->
                <div>
                    <h2 class="text-xl font-semibold text-slate-700 mb-4 border-b pb-3">사원 등록</h2>
                    <form id="employee-form" class="space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="emp-name" class="block text-sm font-medium text-slate-600">이름</label>
                                <input type="text" id="emp-name" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
                            </div>
                            <div>
                                 <label for="emp-position" class="block text-sm font-medium text-slate-600">직급</label>
                                 <input type="text" id="emp-position" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
                            </div>
                        </div>
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center">
                            <div>
                                <label for="emp-department-select" class="block text-sm font-medium text-slate-600">부서</label>
                                <select id="emp-department-select" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"></select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600">사진</label>
                                <div class="mt-1">
                                    <label for="emp-photo" class="file-input-label">파일 선택</label>
                                    <input type="file" id="emp-photo" accept="image/*">
                                    <span id="file-name-display" class="file-name-display"></span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <button type="submit" class="inline-flex justify-center py-2 px-5 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                등록
                            </button>
                        </div>
                    </form>
                </div>
                 <!-- 사원 목록 -->
                <div>
                    <h2 class="text-xl font-semibold text-slate-700 mb-4 border-b pb-3">사원 전체 목록</h2>
                    <div class="h-[58vh] overflow-y-auto pr-2">
                        <table class="min-w-full">
                            <thead class="bg-slate-100 sticky top-0">
                                <tr>
                                    <th class="py-2 px-3 uppercase font-semibold text-sm text-slate-600 w-12">사진</th>
                                    <th class="text-left py-2 px-3 uppercase font-semibold text-sm text-slate-600">이름</th>
                                    <th class="text-left py-2 px-3 uppercase font-semibold text-sm text-slate-600">부서</th>
                                    <th class="text-left py-2 px-3 uppercase font-semibold text-sm text-slate-600">직급</th>
                                    <th class="text-center py-2 px-3 uppercase font-semibold text-sm text-slate-600">관리</th>
                                </tr>
                            </thead>
                            <tbody id="employee-list" class="text-slate-700">
                                <!-- JS로 동적 생성 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- ======================================================= -->
            <!-- 오른쪽 컬럼: 휴가 관리 -->
            <!-- ======================================================= -->
            <section class="lg:col-span-2 bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-8">
                 <!-- 휴가 신청 -->
                 <div>
                    <h2 class="text-xl font-semibold text-slate-700 mb-4 border-b pb-3">사원 휴가 신청</h2>
                    <form id="vacation-form" class="space-y-4">
                        <div>
                            <label for="vacation-emp-select" class="block text-sm font-medium text-slate-600">신청 사원</label>
                            <select id="vacation-emp-select" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500"></select>
                        </div>
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="vacation-start-date" class="block text-sm font-medium text-slate-600">휴가 시작일</label>
                                <input type="date" id="vacation-start-date" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500">
                            </div>
                             <div>
                                <label for="vacation-end-date" class="block text-sm font-medium text-slate-600">휴가 종료일</label>
                                <input type="date" id="vacation-end-date" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500">
                            </div>
                        </div>
                        <div>
                            <label for="vacation-reason" class="block text-sm font-medium text-slate-600">휴가 사유</label>
                            <input type="text" id="vacation-reason" required placeholder="예: 여름 휴가" class="mt-1 block w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500">
                        </div>
                        <div class="text-right">
                             <button type="submit" class="inline-flex justify-center py-2 px-5 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors">
                                신청
                            </button>
                        </div>
                    </form>
                </div>
                <!-- 휴가 신청 목록 -->
                <div>
                     <h2 class="text-xl font-semibold text-slate-700 mb-4 border-b pb-3">휴가 신청 전체 목록</h2>
                     <div id="vacation-list" class="space-y-3 h-[45vh] overflow-y-auto pr-2">
                        <!-- JS로 동적 생성 -->
                     </div>
                </div>
            </section>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // =======================================================
        // 데이터 모델 및 상태 관리
        // =======================================================
        let departments = [
            { id: 1, name: '개발팀' },
            { id: 2, name: '디자인팀' },
            { id: 3, name: '기획팀' },
            { id: 4, name: '마케팅팀' }
        ];
        let nextDepartmentId = 5;

        let employees = [
            { id: 1, name: '김민준', departmentId: 1, position: '선임 개발자', photoUrl: 'https://placehold.co/40x40/E3EEFF/1A202C?text=N/A' },
            { id: 2, name: '이서연', departmentId: 2, position: '수석 디자이너', photoUrl: 'https://placehold.co/40x40/F3E7E9/1A202C' },
            { id: 3, name: '박도윤', departmentId: 3, position: '팀장', photoUrl: 'https://placehold.co/40x40/E8F5E9/1A202C' },
            { id: 4, name: '최아린', departmentId: 4, position: '대리', photoUrl: 'https://placehold.co/40x40/FFFDE7/1A202C' },
            { id: 5, name: '정하준', departmentId: 1, position: '주니어 개발자', photoUrl: 'https://placehold.co/40x40/F1F8E9/1A202C' }
        ];
        let nextEmployeeId = 6;
        
        let vacationRequests = [
            { id: 1, employeeId: 2, startDate: '2025-07-21', endDate: '2025-07-25', reason: '여름 휴가', requestDate: '2025-06-10T10:00:00Z' },
            { id: 2, employeeId: 1, startDate: '2025-08-04', endDate: '2025-08-04', reason: '병원 진료', requestDate: '2025-06-15T11:30:00Z' },
        ];
        let nextVacationId = 3;

        // =======================================================
        // DOM 요소
        // =======================================================
        const departmentForm = document.getElementById('department-form');
        const departmentListContainer = document.getElementById('department-list');
        const employeeForm = document.getElementById('employee-form');
        const empDepartmentSelect = document.getElementById('emp-department-select');
        const empPhotoInput = document.getElementById('emp-photo');
        const fileNameDisplay = document.getElementById('file-name-display');
        const employeeListBody = document.getElementById('employee-list');
        const vacationForm = document.getElementById('vacation-form');
        const vacationListContainer = document.getElementById('vacation-list');
        const vacationEmpSelect = document.getElementById('vacation-emp-select');

        // =======================================================
        // 유틸리티 함수
        // =======================================================
        const findEmployeeById = (id) => employees.find(emp => emp.id === id);
        const findDepartmentById = (id) => departments.find(dept => dept.id === id);

        // =======================================================
        // 렌더링 함수
        // =======================================================
        const renderDepartmentList = () => {
            departmentListContainer.innerHTML = '';
            if (departments.length === 0) {
                departmentListContainer.innerHTML = `<tr><td colspan="2" class="text-center py-4 text-slate-400 text-sm">등록된 부서가 없습니다.</td></tr>`;
                return;
            }
            departments.forEach(dept => {
                const row = `<tr class="border-b border-slate-200 text-sm"><td class="py-2 px-3">${dept.name}</td><td class="py-2 px-3 text-center"><button data-id="${dept.id}" class="delete-department-btn text-red-500 hover:text-red-700 text-xs">삭제</button></td></tr>`;
                departmentListContainer.innerHTML += row;
            });
        };

        const renderDepartmentSelect = () => {
            empDepartmentSelect.innerHTML = '<option value="" disabled selected>부서를 선택하세요</option>';
            departments.forEach(dept => {
                const option = `<option value="${dept.id}">${dept.name}</option>`;
                empDepartmentSelect.innerHTML += option;
            });
        };

        const renderEmployeeList = () => {
            employeeListBody.innerHTML = '';
            if (employees.length === 0) {
                employeeListBody.innerHTML = `<tr><td colspan="5" class="text-center py-10 text-slate-500">등록된 사원이 없습니다.</td></tr>`;
                return;
            }
            employees.forEach(emp => {
                const department = findDepartmentById(emp.departmentId);
                const deptName = department ? department.name : '미배정';
                const row = `
                    <tr class="border-b border-slate-200 text-sm">
                        <td class="py-2 px-3"><img src="${emp.photoUrl}" alt="${emp.name}" class="emp-photo"></td>
                        <td class="py-3 px-3 font-medium">${emp.name}</td>
                        <td class="py-3 px-3">${deptName}</td>
                        <td class="py-3 px-3">${emp.position}</td>
                        <td class="py-3 px-3 text-center">
                            <button data-id="${emp.id}" class="delete-employee-btn text-red-500 hover:text-red-700 text-xs">삭제</button>
                        </td>
                    </tr>
                `;
                employeeListBody.innerHTML += row;
            });
        };

        const renderVacationEmpSelect = () => {
            vacationEmpSelect.innerHTML = '<option value="" disabled selected>휴가 신청 사원을 선택하세요</option>';
            employees.forEach(emp => {
                const department = findDepartmentById(emp.departmentId);
                const deptName = department ? department.name : '미배정';
                const option = `<option value="${emp.id}">${emp.name} (${deptName})</option>`;
                vacationEmpSelect.innerHTML += option;
            });
        };

        const renderVacationList = () => {
            vacationListContainer.innerHTML = '';
            const sortedRequests = [...vacationRequests].sort((a,b) => new Date(b.requestDate) - new Date(a.requestDate));

            if (sortedRequests.length === 0) {
                vacationListContainer.innerHTML = '<p class="text-center text-slate-500 py-10">휴가 신청 내역이 없습니다.</p>';
                return;
            }
            sortedRequests.forEach(req => {
                const employee = findEmployeeById(req.employeeId);
                const empName = employee ? employee.name : '퇴사자';
                const item = `
                    <div class="p-4 rounded-lg border border-slate-200 bg-slate-50">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-semibold text-slate-800">${empName}</p>
                                <p class="text-sm text-slate-600">${req.startDate} ~ ${req.endDate}</p>
                                <p class="text-xs text-slate-500 mt-1">사유: ${req.reason}</p>
                            </div>
                            <button data-id="${req.id}" class="cancel-vacation-btn text-xs font-medium text-white bg-slate-400 hover:bg-slate-500 px-2 py-1 rounded-md">신청취소</button>
                        </div>
                    </div>
                `;
                vacationListContainer.innerHTML += item;
            });
        };
        
        const renderAll = () => {
            renderDepartmentList();
            renderDepartmentSelect();
            renderEmployeeList();
            renderVacationEmpSelect();
            renderVacationList();
        };

        // =======================================================
        // 이벤트 핸들러
        // =======================================================
        departmentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const deptNameInput = document.getElementById('dept-name');
            const newDeptName = deptNameInput.value.trim();
            if (!newDeptName) return;

            if (departments.some(dept => dept.name === newDeptName)) {
                alert('이미 존재하는 부서명입니다.');
                return;
            }
            
            departments.push({ id: nextDepartmentId++, name: newDeptName });
            deptNameInput.value = '';
            renderAll();
        });

        departmentListContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-department-btn')) {
                const deptId = parseInt(e.target.dataset.id);
                const isEmployeeAssigned = employees.some(emp => emp.departmentId === deptId);
                if (isEmployeeAssigned) {
                    alert('해당 부서에 소속된 사원이 있어 삭제할 수 없습니다.');
                    return;
                }
                if (confirm('정말 이 부서를 삭제하시겠습니까?')) {
                    departments = departments.filter(dept => dept.id !== deptId);
                    renderAll();
                }
            }
        });
        
        empPhotoInput.addEventListener('change', () => {
            const file = empPhotoInput.files[0];
            fileNameDisplay.textContent = file ? file.name : '';
        });

        employeeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const photoFile = empPhotoInput.files[0];
            
            const newEmployee = {
                id: nextEmployeeId++,
                name: document.getElementById('emp-name').value.trim(),
                departmentId: parseInt(document.getElementById('emp-department-select').value),
                position: document.getElementById('emp-position').value.trim(),
                photoUrl: photoFile ? URL.createObjectURL(photoFile) : 'https://placehold.co/40x40/CBD5E1/475569?text=N/A'
            };
            if (!newEmployee.name || !newEmployee.departmentId || !newEmployee.position) {
                alert('모든 필드를 입력해주세요.');
                return;
            }
            employees.push(newEmployee);
            employeeForm.reset();
            fileNameDisplay.textContent = '';
            renderAll();
        });

        employeeListBody.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-employee-btn')) {
                const empId = parseInt(e.target.dataset.id);
                if (confirm('해당 사원을 삭제하면 관련된 모든 휴가 신청 기록도 삭제됩니다. 정말 삭제하시겠습니까?')) {
                    employees = employees.filter(emp => emp.id !== empId);
                    vacationRequests = vacationRequests.filter(req => req.employeeId !== empId);
                    renderAll();
                }
            }
        });

        vacationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const startDate = document.getElementById('vacation-start-date').value;
            const endDate = document.getElementById('vacation-end-date').value;
            if (new Date(startDate) > new Date(endDate)) {
                alert('휴가 종료일은 시작일보다 빠를 수 없습니다.');
                return;
            }
            const newRequest = {
                id: nextVacationId++,
                employeeId: parseInt(document.getElementById('vacation-emp-select').value),
                startDate: startDate,
                endDate: endDate,
                reason: document.getElementById('vacation-reason').value.trim(),
                requestDate: new Date().toISOString()
            };
            if (!newRequest.employeeId || !newRequest.startDate || !newRequest.endDate || !newRequest.reason) {
                alert('모든 필드를 입력해주세요.');
                return;
            }
            vacationRequests.push(newRequest);
            vacationForm.reset();
            renderAll();
        });

        vacationListContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('cancel-vacation-btn')) {
                const reqId = parseInt(e.target.dataset.id);
                if (confirm('이 휴가 신청을 취소하시겠습니까?')) {
                    vacationRequests = vacationRequests.filter(req => req.id !== reqId);
                    renderAll();
                }
            }
        });

        // =======================================================
        // 초기화
        // =======================================================
        renderAll();
    });
    </script>
</body>
</html>
